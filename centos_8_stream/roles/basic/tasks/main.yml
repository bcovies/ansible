---
- name: Atualizando o repositório do CentOs.
  shell: dnf -y update

# DNS
- name: "[WORKAROUND (CENTOS 8)]: Altera o DNS da máquina"
  shell: echo "nameserver 192.168.1.200" > /etc/resolv.conf; echo "nameserver 192.168.1.254" >> /etc/resolv.conf;  chattr +i /etc/resolv.conf;

- name: "Cria as pastas de montagem"
  shell: mkdir /mnt/{hdd,ssd}

- name: "Adiciona /dev/sdb montagem ao fstab"
  shell: echo "/dev/sdb /mnt/hdd auto defaults 0 0" >> /etc/fstab

- name: "Adiciona /dev/sda montagem ao fstab"
  shell: echo "/dev/sda /mnt/ssd auto defaults 0 0" >> /etc/fstab

- name: Instalando pacotes básicos para o servidor.
  yum:
    state: latest
    name: [ "epel-release", "yum-utils", "dkms","kernel-devel" ,"kernel-devel-4.18.0-305.el8.x86_64" ]

- name: Verificando a instalação dos pacotes básicos para o servidor.
  yum:
    state: present
    name: [ "epel-release", "yum-utils", "dkms","kernel-devel" ,"kernel-devel-4.18.0-305.el8.x86_64" ]

- name: Copiando o repositório de instalação do VirtualBox.
  copy:
    src: files/VirtualBox.repo
    dest: '{{ dir_repositorio }}/VirtualBox.repo'

- name: Copiando o repositório de instalação do Hashicorp.
  copy:
    src: files/Hashicorp.repo
    dest: '{{ dir_repositorio }}/Hashicorp.repo'

- name: Instalando {{ virtualbox_versao }}
  yum:
    name: [ '{{ virtualbox_versao }}' ]
    state: latest

- name: Confirmando a instalação {{ virtualbox_versao }}
  yum:
    name: [ '{{ virtualbox_versao }}' ]
    state: present

- name: Instalando Vagrant
  yum:
    name: vagrant
    state: latest

- name: Confirmando a instalação Vagrant
  yum:
    name: vagrant
    state: present

- name: Instalando plugin vagrant 
  shell: vagrant plugin install vagrant-vbguest
